databaseChangeLog:
  - changeSet:
      id: 006-create-questions-sequence-trigger
      author: puhlikov
      changes:
        - sql:
            sql: CREATE OR REPLACE FUNCTION sync_questions_sequence() RETURNS TRIGGER AS $BODY$ DECLARE max_id BIGINT; seq_name TEXT; BEGIN SELECT COALESCE(MAX(id), 0) INTO max_id FROM questions; seq_name := pg_get_serial_sequence('questions', 'id'); IF seq_name IS NOT NULL AND max_id > 0 THEN PERFORM setval(seq_name, max_id + 1, false); END IF; RETURN NEW; END; $BODY$ LANGUAGE plpgsql;
            splitStatements: false
        - sql:
            sql: DROP TRIGGER IF EXISTS sync_questions_sequence_trigger ON questions;
            splitStatements: false
        - sql:
            sql: CREATE TRIGGER sync_questions_sequence_trigger BEFORE INSERT ON questions FOR EACH ROW EXECUTE FUNCTION sync_questions_sequence();
            splitStatements: false

